# Copyright 2024 Syntio Ltd.
#
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.

config:

  #################################### PRODUCT CONFIG #####################################

  namespace: dataphos
  # component selection
  deploySchemaRegistry: true
  deploySchemaRegistryValidator: true
  deployPersistor: true

  resourceTags:
    team: dataphos
    env: dev

  # schema registry chart config
  dataphos-schema-registry:
    registryReplicas: 1

    # History database.
    database:
      name: postgres
      username: postgres
      password: POSTGRES_PASSWORD

  # schema registry validator chart config
  dataphos-schema-registry-validator:
    xmlValidator:
      enable: true
      replicas: 1

    csvValidator:
      enable: true
      replicas: 1

    validator:
      validator:
        broker: servicebus
        destinationBroker: servicebus
        topic: input-topic
        consumerID: input-topic-sub-scval
        validTopic: valid-topic
        deadletterTopic: deadletter-topic
        replicas: 1

  # persistor chart config
  dataphos-persistor:
    persistor:
      persistor:
        broker: servicebus
        topic: input-topic
        consumerID: input-topic-sub-per
        storage: azure-blob-storage
        storageTargetID: dest-bucket
        indexer: indexer # Indexer reference (if not set the indexer plugin is disabled)
        replicas: 1

    indexer:
      indexer:
        broker: servicebus
        topic: indexer-topic
        consumerID: indexer-topic-sub
        replicas: 1 # Scale the service exposing the metadata
        consumerReplicas: 1 # Scale the consumers reading and storing the metadata
        storageSize: 1Gi

    resubmitter:
      resubmitter:
        broker: servicebus
        storage: azure-blob-storage
        indexer: indexer

  ################################# INFRASTRUCTURE CONFIG #################################

  # provider config
  azure-native:location: westeurope

  # cluster config
  cluster:
    aks-cluster:
      type: aks
      name: aks-cluster
      resourceGroup: dataphos-rg


  # broker config
  brokers:
    servicebus:
      type: servicebus
      resourceGroup: dataphos-rg
      azsbNamespace: dataphos-sb-ns

      topics:
        input-topic:
          subscriptions:
            input-topic-sub-per: {}
            input-topic-sub-scval: {}
        valid-topic: {}
        deadletter-topic: {}
        indexer-topic:
          subscriptions:
            indexer-topic-sub: {}


  # storage config
  storage:
    azure-blob-storage:
      type: abs
      resourceGroup: dataphos-rg
      accountStorageID: dataphosstorageacc

      buckets:
        dest-bucket: {}
